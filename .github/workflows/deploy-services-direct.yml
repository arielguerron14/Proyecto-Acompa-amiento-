name: Deploy Services - Direct Execution

on:
  workflow_dispatch:
    inputs:
      target_service:
        description: 'Target service to deploy'
        required: true
        default: 'all'
        type: choice
        options:
          - core
          - api-gateway
          - frontend
          - all

jobs:
  deploy-services:
    name: Deploy Services to Instances
    runs-on: ubuntu-latest
    environment: production
    
    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Configure AWS credentials
      uses: aws-actions/configure-aws-credentials@v2
      with:
        aws-access-key-id: ${{ secrets.AWS_ACCESS_KEY_ID }}
        aws-secret-access-key: ${{ secrets.AWS_SECRET_ACCESS_KEY }}
        aws-session-token: ${{ secrets.AWS_SESSION_TOKEN }}
        aws-region: us-east-1

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18'

    - name: Run Deployment Script
      run: |
        python3 scripts/deploy-services.py

    - name: Summary
      run: |
        echo ""
        echo "════════════════════════════════════════════════════════════"
        echo "✅ DEPLOYMENT ORCHESTRATION COMPLETE"
        echo "════════════════════════════════════════════════════════════"
        echo ""
        echo "Services are ready to be deployed!"
        echo ""

