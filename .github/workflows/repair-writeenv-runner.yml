name: Repair write-env runner (TEMPORARY MINIMAL)

on:
  workflow_dispatch:
    inputs:
      target:
        description: 'Target group: reportes|notificaciones|all'
        required: false
        default: 'reportes'
  push:
    branches: [ 'run-repair' ]

jobs:
  smoke-validate:
    runs-on: ubuntu-latest
    env:
      TARGET: ${{ github.event.inputs.target }}
    steps:
      - name: Smoke validate
        run: |
          echo "SMOKE: minimal repair-writeenv-runner executed"
          echo "If this succeeds, the original workflow contains the problematic block"
      - name: Prepare SSH key
        run: |
          echo "${{ secrets.EC2_KEY }}" > key.pem
          chmod 600 key.pem

      - name: Minimal check - ensure SSH key works
        run: |
          # Attempt to list the home directory on the EC2 host to validate SSH connectivity
          ssh -o StrictHostKeyChecking=no -i key.pem ${{ secrets.EC2_USER }}@${{ secrets.EC2_REPORTES_HOST }} 'ls -lad $HOME' || true
