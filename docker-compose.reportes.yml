version: '3.8'

services:
  micro-reportes-estudiantes:
    container_name: micro-reportes-estudiantes
    image: proyecto-acompanamiento:micro-reportes-estudiantes
    build:
      context: ./micro-reportes-estudiantes
      dockerfile: Dockerfile
    ports:
      - "5003:5003"
    environment:
      NODE_ENV: production
      PORT: 5003
      DB_HOST: 172.31.79.193
      DB_PORT: 5432
      DB_NAME: reportes
      MONGODB_URL: mongodb://172.31.79.193:27017/reportes
      AUTH_SERVICE: http://172.31.78.183:3000
      ESTUDIANTES_SERVICE: http://172.31.78.183:3001
      KAFKA_BROKERS: 172.31.73.6:9092
    networks:
      - vpc-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5003/health"]
      interval: 10s
      timeout: 5s
      retries: 3

  micro-reportes-maestros:
    container_name: micro-reportes-maestros
    image: proyecto-acompanamiento:micro-reportes-maestros
    build:
      context: ./micro-reportes-maestros
      dockerfile: Dockerfile
    ports:
      - "5004:5004"
    environment:
      NODE_ENV: production
      PORT: 5004
      DB_HOST: 172.31.79.193
      DB_PORT: 5432
      DB_NAME: reportes
      MONGODB_URL: mongodb://172.31.79.193:27017/reportes
      AUTH_SERVICE: http://172.31.78.183:3000
      MAESTROS_SERVICE: http://172.31.78.183:3002
      KAFKA_BROKERS: 172.31.73.6:9092
    networks:
      - vpc-network
    restart: unless-stopped
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:5004/health"]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  vpc-network:
    driver: bridge
    ipam:
      config:
        - subnet: 172.18.0.0/16
