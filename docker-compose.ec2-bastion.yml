version: '3.8'

services:
  bastion-host:
    image: bastion-host:latest
    container_name: bastion-host
    hostname: bastion-host
    restart: always
    
    networks:
      - bastion-net
    
    ports:
      - "2222:22"
    expose:
      - "22"
    
    volumes:
      - bastion-logs:/var/log/bastion
      - bastion-auth:/var/log
      - bastion-ssh-config:/etc/ssh
    
    deploy:
      resources:
        limits:
          cpus: '1'
          memory: 1G
        reservations:
          cpus: '0.5'
          memory: 512M
    
    environment:
      TZ: UTC
      BASTION_PORT: 22
      LOG_LEVEL: INFO
    
    healthcheck:
      test: ["CMD", "nc", "-z", "localhost", "22"]
      interval: 30s
      timeout: 10s
      retries: 3
      start_period: 40s

networks:
  bastion-net:
    driver: bridge

volumes:
  bastion-logs:
  bastion-auth:
  bastion-ssh-config:
