version: '3.8'

services:
  api-gateway:
    build:
      context: ./api-gateway
      dockerfile: Dockerfile
    image: api-gateway:latest
    container_name: api-gateway
    restart: unless-stopped
    ports:
      - "8080:8080"
    networks:
      - api-gateway-net
    environment:
      NODE_ENV: production
      DOCKER_DEPLOYMENT: "false"
      API_GATEWAY_PORT: 8080
      PORT: 8080
      # These will be dynamically configured based on EC2-CORE private IP
      CORE_HOST: "http://localhost"
      LOG_LEVEL: debug
      JWT_SECRET: ${JWT_SECRET:-your-secret-key}
      RATE_LIMIT: 100
      TIMEOUT: 30000
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  api-gateway-net:
    driver: bridge

