version: '3.8'

services:
  api-gateway:
    image: ${DOCKER_USERNAME}/api-gateway:latest
    container_name: api-gateway
    restart: unless-stopped
    ports:
      - "8080:8080"
    networks:
      - api-gateway-net
    environment:
      NODE_ENV: production
      PORT: 8080
      CORE_HOST: "http://localhost"
      LOG_LEVEL: info
      # CORS Configuration - reads from api-gateway/.env
      CORS_ORIGIN: ${CORS_ORIGIN}
      EC2_CORE_IP: ${EC2_CORE_IP}
      # Microservices URLs (for Docker internal communication)
      AUTH_SERVICE_URL: http://micro-auth:3000
      ESTUDIANTES_SERVICE_URL: http://micro-estudiantes:3001
      MAESTROS_SERVICE_URL: http://micro-maestros:3002
      REPORTES_EST_SERVICE: http://micro-reportes-estudiantes:5003
      REPORTES_MAEST_SERVICE: http://micro-reportes-maestros:5004
      # Database connections
      MONGO_URL: mongodb://admin:MyMongoProd123!@db:27017/acompaamiento?authSource=admin
      POSTGRES_URL: postgresql://admin:MyPostgresProd123!@db:5432/acompaamiento
    healthcheck:
      test: ["CMD", "curl", "-f", "http://localhost:8080/health"]
      interval: 10s
      timeout: 5s
      retries: 3

networks:
  api-gateway-net:
    driver: bridge

